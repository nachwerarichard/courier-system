<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courier System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <header class="bg-white border-b px-6 py-3 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded flex items-center justify-center text-white font-bold">C</div>
            <h1 class="font-bold text-xl tracking-tight uppercase">Courier<span class="text-blue-600">Sys</span></h1>
        </div>
        <div class="flex items-center gap-6">
            <div class="text-right border-r pr-4">
                <p id="staff-name-display" class="font-semibold text-sm">--</p>
                <p id="staff-station-display" class="text-xs text-blue-600 font-bold italic"></p>
            </div>
            <button onclick="window.location.href='login.html'" class="bg-gray-100 hover:bg-red-50 text-red-600 p-2 rounded-full transition-colors">
                <i class="fa-solid fa-right-from-bracket"></i>
            </button>
        </div>
    </header>

    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col no-print">
            <nav class="flex-1 p-4 space-y-1">
                <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Main Menu</p>
                <a href="#" class="flex items-center gap-3 p-3 bg-blue-600 text-white rounded-lg shadow-lg"><i class="fa-solid fa-chart-line w-5"></i> Dashboard</a>
                <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg transition-all"><i class="fa-solid fa-box w-5"></i> All Parcels</a>
                <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg transition-all"><i class="fa-solid fa-receipt w-5"></i> Financials</a>
                <div id="admin-menu" class="hidden pt-4 border-t border-slate-800 mt-4">
                    <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Administration</p>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-user-shield w-5"></i> Staff Users</a>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-gears w-5"></i> Settings</a>
                </div>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto p-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                    <p class="text-gray-400 text-[10px] font-bold uppercase">Total Today</p>
                    <h3 id="stat-total" class="text-2xl font-black">0</h3>
                </div>
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm border-l-4 border-green-500">
                    <p class="text-green-600 text-[10px] font-bold uppercase">In Transit</p>
                    <h3 id="stat-transit" class="text-2xl font-black">0</h3>
                </div>
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm border-l-4 border-blue-500">
                    <p class="text-blue-600 text-[10px] font-bold uppercase">Ready Pickup</p>
                    <h3 id="stat-pickup" class="text-2xl font-black">0</h3>
                </div>
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm border-l-4 border-orange-500">
                    <p class="text-orange-600 text-[10px] font-bold uppercase">Delivered</p>
                    <h3 id="stat-delivered" class="text-2xl font-black">0</h3>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl border mb-6 flex flex-wrap gap-4 items-center justify-between">
                <div class="flex gap-2">
                    <button onclick="showModal('senderModal')" class="bg-slate-800 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Register Sender
                    </button>
                    <button onclick="showModal('parcelModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2">
                        <i class="fa-solid fa-circle-plus"></i> Create Parcel
                    </button>
                </div>
                <div class="flex-1 max-w-sm">
                    <input type="text" id="mainSearch" placeholder="Quick Search Tracking # or Phone..." class="w-full border rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <div class="bg-white rounded-xl border shadow-sm overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b text-[10px] uppercase font-black text-slate-400">
                        <tr>
                            <th class="px-6 py-4">Tracking</th>
                            <th class="px-6 py-4">Client Detail</th>
                            <th class="px-6 py-4">Route</th>
                            <th class="px-6 py-4">Payment</th>
                            <th class="px-6 py-4">Status</th>
                            <th class="px-6 py-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="parcelTableBody" class="divide-y text-sm">
                        </tbody>
                </table>
            </div>
        </main>
    </div>

    <div id="senderModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="p-6 border-b bg-gray-50 flex justify-between items-center">
                <h3 class="font-black text-slate-800 uppercase">New Sender Registration</h3>
                <button onclick="hideModal('senderModal')" class="text-slate-400">&times;</button>
            </div>
            <form id="senderForm" class="p-6 space-y-4">
                <input type="text" id="sPhone" placeholder="Phone Number (Required)" class="w-full border p-3 rounded-lg outline-blue-500" required>
                <input type="text" id="sName" placeholder="Full Name" class="w-full border p-3 rounded-lg outline-blue-500" required>
                <input type="text" id="sID" placeholder="ID Number (Optional)" class="w-full border p-3 rounded-lg outline-blue-500">
                <button type="submit" class="w-full bg-slate-800 text-white font-bold py-3 rounded-lg">Register Client</button>
            </form>
        </div>
    </div>

    <div id="parcelModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl my-auto">
            <div class="p-6 border-b bg-gray-50 flex justify-between">
                <h3 class="font-black text-slate-800 uppercase">New Parcel Intake</h3>
                <button onclick="hideModal('parcelModal')" class="text-slate-400 text-2xl">&times;</button>
            </div>
            <form id="parcelForm" class="p-6 grid grid-cols-2 gap-6">
                <div class="col-span-2 md:col-span-1 space-y-4">
                    <p class="text-xs font-black text-blue-600 uppercase border-b pb-1">1. Parcel Info</p>
                    <textarea id="pDesc" placeholder="Description of items..." class="w-full border p-3 rounded-lg h-24 text-sm" required></textarea>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="pQty" placeholder="Qty" class="border p-3 rounded-lg text-sm" required>
                        <input type="number" id="pWeight" placeholder="Weight(Kg)" class="border p-3 rounded-lg text-sm" required>
                    </div>
                </div>
                <div class="col-span-2 md:col-span-1 space-y-4">
                    <p class="text-xs font-black text-blue-600 uppercase border-b pb-1">2. Destination</p>
                    <input type="text" id="pReceiver" placeholder="Receiver Full Name" class="w-full border p-3 rounded-lg text-sm" required>
                    <select id="pDest" class="w-full border p-3 rounded-lg text-sm" required>
                        <option value="">Select Destination</option>
                        <option value="Kampala">Kampala</option>
                        <option value="Mbale">Mbale</option>
                    </select>
                </div>
                <div class="col-span-2 bg-slate-50 p-4 rounded-xl space-y-4 border border-slate-200">
                    <p class="text-xs font-black text-green-700 uppercase">3. Payment & Calculation</p>
                    <div class="grid grid-cols-3 gap-4">
                        <select id="pPayStatus" class="border p-3 rounded-lg text-sm">
                            <option value="Unpaid">Unpaid</option>
                            <option value="Paid">Fully Paid</option>
                            <option value="Partial">Partial Payment</option>
                        </select>
                        <input type="number" id="pTotal" placeholder="Total Cost (UGX)" class="border p-3 rounded-lg text-sm" required>
                        <input type="number" id="pPaid" placeholder="Amt Collected" class="border p-3 rounded-lg text-sm">
                    </div>
                </div>
                <div class="col-span-2 pt-4">
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-100 uppercase tracking-widest">
                        Save Parcel & Print Waybill
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="receiptModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-8 shadow-2xl relative">
            <div id="receiptContent" class="text-center font-mono text-sm">
                <p class="font-black text-xl">COURIER SYS</p>
                <p id="rStation" class="mb-4">Mbale Branch</p>
                <hr class="border-dashed my-2">
                <div class="text-left space-y-1">
                    <p class="font-bold">TRK: <span id="rTrk">--</span></p>
                    <p>SND: <span id="rSnd">--</span></p>
                    <p>RCV: <span id="rRcv">--</span></p>
                    <p>DEST: <span id="rDest">--</span></p>
                </div>
                <hr class="border-dashed my-4">
                <div class="flex justify-between font-bold">
                    <span>TOTAL:</span>
                    <span id="rTotal">0</span>
                </div>
                <div class="flex justify-between">
                    <span>PAID:</span>
                    <span id="rPaid">0</span>
                </div>
                <div class="flex justify-between text-red-600 font-bold border-t pt-1">
                    <span>BAL:</span>
                    <span id="rBal">0</span>
                </div>
                <hr class="border-dashed my-4">
                <p class="text-[10px]">Thank you for shipping with us.</p>
            </div>
            <div class="mt-6 flex gap-2 no-print">
                <button onclick="window.print()" class="flex-1 bg-slate-800 text-white py-2 rounded">Print</button>
                <button onclick="hideModal('receiptModal')" class="flex-1 bg-gray-200 py-2 rounded">Close</button>
            </div>
        </div>
    </div>

    <script >
      /**
 * COURIER SYSTEM DASHBOARD CORE LOGIC
 * Follows Flow 1-7 and Database Schema
 */

const state = {
    staff: {
        name: localStorage.getItem('staffName') || "Musa Clerk",
        station: localStorage.getItem('staffStation') || "Mbale",
        role: localStorage.getItem('staffRole') || "clerk"
    },
    parcels: [
        { id: 1, tracking: "TRK-2201", sender: "Ivan Kato", receiver: "Grace Nam", destination: "Kampala", status: "In Transit", payment: "Paid", total: 45000, paid: 45000, balance: 0 },
        { id: 2, tracking: "TRK-2202", sender: "Ali Sula", receiver: "Bob Okello", destination: "Mbale", status: "At Dispatch", payment: "Unpaid", total: 30000, paid: 0, balance: 30000 }
    ],
    clients: []
};

// 1. Initialize System
function init() {
    document.getElementById('staff-name-display').innerText = state.staff.name;
    document.getElementById('staff-station-display').innerText = `STATION: ${state.staff.station}`;
    
    if(state.staff.role === 'admin') {
        document.getElementById('admin-menu').classList.remove('hidden');
    }

    renderTable();
    updateStats();
}

// 2. Render Table with Status Color-Coding
function renderTable() {
    const tbody = document.getElementById('parcelTableBody');
    tbody.innerHTML = "";

    state.parcels.forEach(p => {
        const row = `
            <tr class="hover:bg-slate-50 transition-colors">
                <td class="px-6 py-4 font-mono font-bold text-blue-600">${p.tracking}</td>
                <td class="px-6 py-4">
                    <div class="font-bold">${p.sender}</div>
                    <div class="text-[10px] text-gray-400">To: ${p.receiver}</div>
                </td>
                <td class="px-6 py-4">
                    <span class="text-xs font-medium text-slate-500">${state.staff.station} &rarr; ${p.destination}</span>
                </td>
                <td class="px-6 py-4">
                    <span class="text-[10px] font-black uppercase ${p.payment === 'Paid' ? 'text-green-600' : 'text-red-500'}">${p.payment}</span>
                    <div class="text-[10px] text-gray-400 italic">Bal: UGX ${p.balance.toLocaleString()}</div>
                </td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${getStatusStyle(p.status)}">
                        ${p.status}
                    </span>
                </td>
                <td class="px-6 py-4 flex gap-2">
                    ${getActionButtons(p)}
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// 3. Flow Logic: Status Updates
function getStatusStyle(status) {
    switch(status) {
        case 'At Dispatch': return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
        case 'In Transit': return 'bg-green-100 text-green-700 border border-green-200';
        case 'Ready for Pickup': return 'bg-blue-100 text-blue-700 border border-blue-200';
        case 'Delivered': return 'bg-orange-100 text-orange-700 border border-orange-200';
        default: return 'bg-gray-100';
    }
}

function getActionButtons(p) {
    if(p.status === 'At Dispatch') return `<button onclick="updateStatus(${p.id}, 'In Transit')" class="bg-green-600 text-white px-2 py-1 rounded text-[10px] font-bold">SEND</button>`;
    if(p.status === 'In Transit' && p.destination === state.staff.station) return `<button onclick="updateStatus(${p.id}, 'Ready for Pickup')" class="bg-blue-600 text-white px-2 py-1 rounded text-[10px] font-bold">ARRIVE</button>`;
    if(p.status === 'Ready for Pickup') return `<button onclick="handleDelivery(${p.id})" class="bg-orange-500 text-white px-2 py-1 rounded text-[10px] font-bold">PICKUP</button>`;
    return `<button class="text-slate-400 text-xs italic" disabled>Complete</button>`;
}

function updateStatus(id, newStatus) {
    const parcel = state.parcels.find(p => p.id === id);
    if(parcel) {
        parcel.status = newStatus;
        // Logic for history recording would trigger here
        renderTable();
        updateStats();
    }
}

// 4. Delivery Confirmation
function handleDelivery(id) {
    const parcel = state.parcels.find(p => p.id === id);
    if(parcel.balance > 0) {
        alert(`Cannot Deliver. Outstanding Balance: UGX ${parcel.balance}`);
        return;
    }
    updateStatus(id, 'Delivered');
}

// 5. Create Parcel Logic
document.getElementById('parcelForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const total = parseFloat(document.getElementById('pTotal').value);
    const paid = parseFloat(document.getElementById('pPaid').value || 0);
    const balance = total - paid;
    
    const newParcel = {
        id: Date.now(),
        tracking: `TRK-${Math.floor(1000 + Math.random() * 9000)}`,
        sender: "Selected Client", // This would pull from Flow 2 logic
        receiver: document.getElementById('pReceiver').value,
        destination: document.getElementById('pDest').value,
        status: "At Dispatch",
        payment: document.getElementById('pPayStatus').value,
        total: total,
        paid: paid,
        balance: balance
    };

    state.parcels.unshift(newParcel);
    hideModal('parcelModal');
    showReceipt(newParcel);
    renderTable();
    updateStats();
});

// 6. Receipt Generation (Confirm Receipt)
function showReceipt(p) {
    document.getElementById('rStation').innerText = `${state.staff.station} Station`;
    document.getElementById('rTrk').innerText = p.tracking;
    document.getElementById('rSnd').innerText = p.sender;
    document.getElementById('rRcv').innerText = p.receiver;
    document.getElementById('rDest').innerText = p.destination;
    document.getElementById('rTotal').innerText = p.total.toLocaleString();
    document.getElementById('rPaid').innerText = p.paid.toLocaleString();
    document.getElementById('rBal').innerText = p.balance.toLocaleString();
    showModal('receiptModal');
}

// Helper Functions
function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
function hideModal(id) { document.getElementById(id).classList.add('hidden'); }
function updateStats() {
    document.getElementById('stat-total').innerText = state.parcels.length;
    document.getElementById('stat-transit').innerText = state.parcels.filter(p => p.status === 'In Transit').length;
    document.getElementById('stat-pickup').innerText = state.parcels.filter(p => p.status === 'Ready for Pickup').length;
    document.getElementById('stat-delivered').innerText = state.parcels.filter(p => p.status === 'Delivered').length;
}

init();
    </script>
</body>
</html>
