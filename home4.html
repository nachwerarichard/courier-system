<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courier System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Smooth transition for login overlay */
        #login-overlay { transition: opacity 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div id="login-overlay" class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex w-16 h-16 bg-blue-600 rounded-xl items-center justify-center text-white text-3xl font-bold mb-4">C</div>
                <h2 class="text-2xl font-black text-slate-800">COURIER<span class="text-blue-600">SYS</span></h2>
                <p class="text-slate-500 text-sm">Please enter your credentials to continue</p>
            </div>
            
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Staff ID / Email</label>
                    <input type="text" id="username" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="admin">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
                    <input type="password" id="password" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="••••••••">
                </div>
                <div id="login-error" class="hidden text-red-500 text-xs font-bold bg-red-50 p-3 rounded-lg">
                    <i class="fa-solid fa-circle-exclamation mr-1"></i> Invalid username or password.
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all transform active:scale-95">
                    Sign In to Dashboard
                </button>
            </form>
            <div class="mt-6 text-center text-xs text-slate-400">
                Authorized Personnel Only • 2026 CourierSys v2.0
            </div>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <header class="bg-white border-b px-6 py-3 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded flex items-center justify-center text-white font-bold">C</div>
                <h1 class="font-bold text-xl tracking-tight">COURIER<span class="text-blue-600">SYS</span></h1>
            </div>
            <div class="flex items-center gap-6">
                <div class="text-right border-r pr-4">
                    <p id="staff-name" class="font-semibold text-sm">--</p>
                    <p id="staff-station" class="text-xs text-blue-600 font-medium italic"></p>
                </div>
                <div class="text-right hidden md:block">
                    <p id="current-date" class="text-xs text-gray-500"></p>
                    <p id="current-time" class="text-xs font-mono"></p>
                </div>
                <button onclick="handleLogout()" class="bg-gray-100 hover:bg-red-50 text-red-600 p-2 rounded-full transition-colors" title="Logout">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </button>
            </div>
        </header>

        <div class="flex h-screen overflow-hidden">
            <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col">
                <nav class="flex-1 p-4 space-y-1">
                    <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Main Menu</p>
                    <a href="#" class="flex items-center gap-3 p-3 bg-blue-600 text-white rounded-lg shadow-lg"><i class="fa-solid fa-chart-line w-5"></i> Dashboard</a>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-users w-5"></i> Senders</a>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-user-tag w-5"></i> Receivers</a>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-box w-5"></i> Parcels</a>
                    <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-receipt w-5"></i> Payments</a>
                    
                    <div id="admin-menu" class="hidden pt-4">
                        <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Administration</p>
                        <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-file-invoice-dollar w-5"></i> Reports</a>
                        <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-user-shield w-5"></i> Users</a>
                        <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-gears w-5"></i> Settings</a>
                    </div>
                </nav>
                <div class="p-4 bg-slate-950 text-[11px]">
                    <p class="font-bold text-slate-500 mb-2 uppercase">Quick Reports</p>
                    <ul class="space-y-1">
                        <li class="hover:text-white cursor-pointer">• Daily Parcel Report</li>
                        <li class="hover:text-white cursor-pointer text-orange-400">• Outstanding Balances</li>
                    </ul>
                </div>
            </aside>

            <main class="flex-1 overflow-y-auto p-6">
                <div id="alerts-container" class="mb-6 space-y-2">
                    <div class="bg-orange-50 border-l-4 border-orange-400 p-3 flex justify-between items-center rounded shadow-sm">
                        <p class="text-sm text-orange-800"><i class="fa-solid fa-circle-exclamation mr-2"></i> <strong>Alert:</strong> 3 parcels have been In Transit longer than expected.</p>
                        <button class="text-orange-400 hover:text-orange-600">×</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-md transition-shadow">
                        <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Total Parcels Today</p>
                        <h3 id="stat-total" class="text-2xl font-black mt-1">0</h3>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                        <p class="text-gray-500 text-xs font-bold uppercase tracking-wider text-green-600">In Transit</p>
                        <h3 id="stat-transit" class="text-2xl font-black mt-1">0</h3>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                        <p class="text-gray-500 text-xs font-bold uppercase tracking-wider text-blue-600">Ready for Pickup</p>
                        <h3 id="stat-pickup" class="text-2xl font-black mt-1 text-blue-600">0</h3>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                        <p class="text-gray-500 text-xs font-bold uppercase tracking-wider text-orange-500">Delivered</p>
                        <h3 id="stat-delivered" class="text-2xl font-black mt-1">0</h3>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="font-bold text-gray-700">Financial Summary</h4>
                            <span class="text-xs text-gray-400 italic">Visible to Clerks & Admins</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <p class="text-xs font-bold text-green-700 uppercase">Total Revenue Today</p>
                                    <p id="rev-today" class="text-2xl font-black text-green-800">UGX 0</p>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                                    <p class="text-xs font-bold text-red-700 uppercase">Outstanding Balances</p>
                                    <p id="bal-total" class="text-2xl font-black text-red-800">UGX 0</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-3">Payment Breakdown</p>
                                <div class="space-y-3">
                                    <div>
                                        <div class="flex justify-between text-xs mb-1"><span>Paid</span><span id="breakdown-paid">0</span></div>
                                        <div class="w-full bg-gray-200 h-1.5 rounded-full"><div id="bar-paid" class="bg-green-500 h-1.5 rounded-full" style="width: 0%"></div></div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs mb-1"><span>Partial</span><span id="breakdown-partial">0</span></div>
                                        <div class="w-full bg-gray-200 h-1.5 rounded-full"><div id="bar-partial" class="bg-yellow-500 h-1.5 rounded-full" style="width: 0%"></div></div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs mb-1"><span>Unpaid</span><span id="breakdown-unpaid">0</span></div>
                                        <div class="w-full bg-gray-200 h-1.5 rounded-full"><div id="bar-unpaid" class="bg-red-500 h-1.5 rounded-full" style="width: 0%"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border p-6">
                        <h4 class="font-bold text-gray-700 mb-4">Quick Actions</h4>
                        <div class="grid grid-cols-1 gap-2">
                            <button onclick="showModal('parcelModal')" class="flex items-center gap-3 w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold transition-all">
                                <i class="fa-solid fa-plus-circle"></i> Create Parcel
                            </button>
                            <button class="flex items-center gap-3 w-full bg-white hover:bg-gray-50 border p-3 rounded-lg font-medium text-gray-700 transition-all">
                                <i class="fa-solid fa-user-plus text-blue-600"></i> Register Sender
                            </button>
                            <button class="flex items-center gap-3 w-full bg-white hover:bg-gray-50 border p-3 rounded-lg font-medium text-gray-700 transition-all">
                                <i class="fa-solid fa-money-bill-transfer text-green-600"></i> Record Payment
                            </button>
                            <button class="flex items-center gap-3 w-full bg-white hover:bg-gray-50 border p-3 rounded-lg font-medium text-gray-700 transition-all">
                                <i class="fa-solid fa-magnifying-glass text-slate-600"></i> Track Parcel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="p-4 border-b bg-gray-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <h4 class="font-bold text-gray-700 italic">Live Station Parcels</h4>
                        <div class="flex gap-2 w-full md:w-auto">
                            <input type="text" id="tableSearch" placeholder="Search Tracking / Phone..." class="border rounded-lg px-4 py-2 text-sm w-full md:w-64 focus:ring-2 focus:ring-blue-500 outline-none">
                            <select id="statusFilter" class="border rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="All">All Statuses</option>
                                <option value="At Dispatch">At Dispatch</option>
                                <option value="In Transit">In Transit</option>
                                <option value="Ready for Pickup">Ready for Pickup</option>
                                <option value="Delivered">Delivered</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-white border-b text-[10px] uppercase font-black text-gray-400">
                                <tr>
                                    <th class="px-6 py-4">Tracking #</th>
                                    <th class="px-6 py-4">Sender / Receiver</th>
                                    <th class="px-6 py-4">Destination</th>
                                    <th class="px-6 py-4 text-center">Payment</th>
                                    <th class="px-6 py-4 text-center">Status</th>
                                    <th class="px-6 py-4">Created</th>
                                    <th class="px-6 py-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="parcelTableBody" class="divide-y divide-gray-100 text-sm"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="parcelModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h2 class="text-xl font-black text-gray-800">New Parcel Registration</h2>
                <button onclick="hideModal('parcelModal')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            <form id="createParcelForm" class="p-6 space-y-6">
                <div>
                    <p class="text-xs font-bold text-blue-600 uppercase mb-2">1. Sender Information</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="senderPhone" placeholder="Search/Enter Phone Number" class="border p-3 rounded-lg w-full outline-blue-500" required>
                        <input type="text" id="senderName" placeholder="Full Name" class="border p-3 rounded-lg w-full outline-blue-500" required>
                    </div>
                </div>
                <div>
                    <p class="text-xs font-bold text-blue-600 uppercase mb-2">2. Parcel & Receiver Details</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" id="receiverName" placeholder="Receiver Name" class="border p-3 rounded-lg w-full outline-blue-500" required>
                        <select id="destination" class="border p-3 rounded-lg w-full outline-blue-500" required>
                            <option value="">Select Destination</option>
                            <option value="Kampala">Kampala</option>
                            <option value="Mbale">Mbale</option>
                        </select>
                    </div>
                    <textarea id="description" placeholder="Description (e.g. 1 Box of Electronics)" class="border p-3 rounded-lg w-full outline-blue-500 h-24" required></textarea>
                </div>
                <div>
                    <p class="text-xs font-bold text-blue-600 uppercase mb-2">3. Payment Capture</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <select id="paymentStatus" class="border p-3 rounded-lg w-full" required>
                            <option value="Unpaid">Unpaid</option>
                            <option value="Paid">Paid</option>
                            <option value="Partial">Partial</option>
                        </select>
                        <input type="number" id="totalAmount" placeholder="Total Cost (UGX)" class="border p-3 rounded-lg w-full">
                        <input type="number" id="amountPaid" placeholder="Amount Paid (UGX)" class="border p-3 rounded-lg w-full">
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="hideModal('parcelModal')" class="px-6 py-3 font-bold text-gray-500">Cancel</button>
                    <button type="submit" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg">Save & Generate Waybill</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // User Credentials (For demo: admin/admin123)
        const AUTH_CONFIG = {
            username: "admin",
            password: "123"
        };

        const state = {
            currentUser: null,
            parcels: [
                { tracking: "C-77210", sender: "Ivan Kato", receiver: "Sarah Nam", destination: "Kampala", pStatus: "Paid", status: "In Transit", amount: 45000, balance: 0, time: "10:20 AM" },
                { tracking: "C-77211", sender: "Grace Ali", receiver: "John Om", destination: "Mbale", pStatus: "Unpaid", status: "At Dispatch", amount: 30000, balance: 30000, time: "11:15 AM" },
                { tracking: "C-77212", sender: "Mark Luta", receiver: "Lillian A", destination: "Kampala", pStatus: "Partial", status: "Ready for Pickup", amount: 50000, balance: 20000, time: "09:05 AM" },
                { tracking: "C-77213", sender: "Doreen K", receiver: "Sula Ben", destination: "Mbale", pStatus: "Paid", status: "Delivered", amount: 25000, balance: 0, time: "Yesterday" }
            ]
        };

        // --- AUTHENTICATION LOGIC ---
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const errorMsg = document.getElementById('login-error');

            if (user === AUTH_CONFIG.username && pass === AUTH_CONFIG.password) {
                // Success
                const userData = { id: 101, name: "Musa Okello", role: "admin", station: "Mbale" };
                localStorage.setItem('courier_user', JSON.stringify(userData));
                showDashboard(userData);
            } else {
                errorMsg.classList.remove('hidden');
            }
        });

        function showDashboard(user) {
            state.currentUser = user;
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            init();
        }

        function handleLogout() {
            localStorage.removeItem('courier_user');
            location.reload(); // Hard reset
        }

        // --- DASHBOARD LOGIC ---
        function init() {
            updateStaffHeader();
            updateDateTime();
            renderParcels();
            calculateFinancials();
            
            if (state.currentUser.role === 'admin') {
                document.getElementById('admin-menu').classList.remove('hidden');
            }
        }

        function updateStaffHeader() {
            document.getElementById('staff-name').innerText = state.currentUser.name;
            document.getElementById('staff-station').innerText = `Station: ${state.currentUser.station}`;
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('en-GB', { dateStyle: 'long' });
            document.getElementById('current-time').innerText = now.toLocaleTimeString();
        }

        function calculateFinancials() {
            const revenue = state.parcels.reduce((acc, p) => acc + (p.amount - p.balance), 0);
            const totalBal = state.parcels.reduce((acc, p) => acc + p.balance, 0);
            
            document.getElementById('rev-today').innerText = `UGX ${revenue.toLocaleString()}`;
            document.getElementById('bal-total').innerText = `UGX ${totalBal.toLocaleString()}`;

            const paid = state.parcels.filter(p => p.pStatus === 'Paid').length;
            const partial = state.parcels.filter(p => p.pStatus === 'Partial').length;
            const unpaid = state.parcels.filter(p => p.pStatus === 'Unpaid').length;
            const total = state.parcels.length;

            document.getElementById('breakdown-paid').innerText = paid;
            document.getElementById('breakdown-partial').innerText = partial;
            document.getElementById('breakdown-unpaid').innerText = unpaid;

            document.getElementById('bar-paid').style.width = `${(paid/total)*100}%`;
            document.getElementById('bar-partial').style.width = `${(partial/total)*100}%`;
            document.getElementById('bar-unpaid').style.width = `${(unpaid/total)*100}%`;

            document.getElementById('stat-total').innerText = state.parcels.length;
            document.getElementById('stat-transit').innerText = state.parcels.filter(p => p.status === 'In Transit').length;
            document.getElementById('stat-pickup').innerText = state.parcels.filter(p => p.status === 'Ready for Pickup').length;
            document.getElementById('stat-delivered').innerText = state.parcels.filter(p => p.status === 'Delivered').length;
        }

        function renderParcels(filterStatus = "All", searchTerm = "") {
            const tbody = document.getElementById('parcelTableBody');
            tbody.innerHTML = "";

            const filtered = state.parcels.filter(p => {
                const matchesStatus = filterStatus === "All" || p.status === filterStatus;
                const matchesSearch = p.tracking.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                     p.sender.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesStatus && matchesSearch;
            });

            filtered.forEach(p => {
                const row = `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 font-mono font-bold text-blue-600">${p.tracking}</td>
                        <td class="px-6 py-4">
                            <div class="font-bold">${p.sender}</div>
                            <div class="text-[10px] text-gray-400">To: ${p.receiver}</div>
                        </td>
                        <td class="px-6 py-4 font-medium text-gray-600">${p.destination}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="text-[10px] font-black uppercase ${p.pStatus === 'Paid' ? 'text-green-600' : 'text-red-500'}">${p.pStatus}</span>
                            <div class="text-[10px] text-gray-400">Bal: ${p.balance}</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${getStatusStyle(p.status)}">${p.status}</span>
                        </td>
                        <td class="px-6 py-4 text-xs text-gray-500">${p.time}</td>
                        <td class="px-6 py-4 text-right">
                            <button class="text-blue-600 hover:text-blue-800 font-bold text-xs uppercase">Update</button>
                        </td>
                    </tr>`;
                tbody.innerHTML += row;
            });
        }

        function getStatusStyle(status) {
            switch(status) {
                case 'At Dispatch': return 'bg-yellow-100 text-yellow-700 border border-yellow-200';
                case 'In Transit': return 'bg-green-100 text-green-700 border border-green-200';
                case 'Ready for Pickup': return 'bg-blue-100 text-blue-700 border border-blue-200';
                case 'Delivered': return 'bg-orange-100 text-orange-700 border border-orange-200';
                default: return 'bg-gray-100 text-gray-700';
            }
        }

        // Modals & Events
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        document.getElementById('createParcelForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const newParcel = {
                tracking: `C-${Math.floor(10000 + Math.random() * 90000)}`,
                sender: document.getElementById('senderName').value,
                receiver: document.getElementById('receiverName').value,
                destination: document.getElementById('destination').value,
                pStatus: document.getElementById('paymentStatus').value,
                status: "At Dispatch",
                amount: parseInt(document.getElementById('totalAmount').value) || 0,
                balance: parseInt(document.getElementById('totalAmount').value) - (parseInt(document.getElementById('amountPaid').value) || 0),
                time: "Just now"
            };
            state.parcels.unshift(newParcel);
            renderParcels();
            calculateFinancials();
            hideModal('parcelModal');
            e.target.reset();
        });

        document.getElementById('tableSearch').addEventListener('input', (e) => renderParcels(document.getElementById('statusFilter').value, e.target.value));
        document.getElementById('statusFilter').addEventListener('change', (e) => renderParcels(e.target.value, document.getElementById('tableSearch').value));

        // Auto-Check Session on Load
        window.onload = () => {
            const savedUser = localStorage.getItem('courier_user');
            if (savedUser) {
                showDashboard(JSON.parse(savedUser));
            }
            setInterval(updateDateTime, 1000);
        };
    </script>
</body>
</html>
