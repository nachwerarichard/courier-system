<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courier System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        #login-overlay { transition: opacity 0.3s ease-in-out; }
        .nav-item.active { @apply bg-blue-600 text-white shadow-lg; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div id="login-overlay" class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex w-16 h-16 bg-blue-600 rounded-xl items-center justify-center text-white text-3xl font-bold mb-4">C</div>
                <h2 class="text-2xl font-black text-slate-800">COURIER<span class="text-blue-600">SYS</span></h2>
                <p class="text-slate-500 text-sm">Authorized Personnel Only</p>
            </div>
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Email</label>
                    <input type="email" id="username" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="admin@courier.com">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
                    <input type="password" id="password" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="••••••••">
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all">Sign In</button>
            </form>
        </div>
    </div>

    <div id="main-content" class="hidden flex flex-col h-screen">
        <header class="bg-white border-b px-6 py-3 flex justify-between items-center z-50">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white font-bold">C</div>
                <h1 class="font-bold text-lg tracking-tight">COURIER<span class="text-blue-600">SYS</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p id="staff-name" class="font-semibold text-sm">--</p>
                    <p id="staff-station-display" class="text-[10px] text-blue-600 font-bold uppercase"></p>
                </div>
                <button onclick="handleLogout()" class="bg-gray-100 text-red-600 p-2 rounded-full"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col">
                <nav class="flex-1 p-4 space-y-1">
                    <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Main Menu</p>
                    <a href="#" onclick="showSection('dashboard')" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800 transition-colors"><i class="fa-solid fa-chart-line w-5"></i> Dashboard</a>
                    <a href="#" onclick="showSection('senders')" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800 transition-colors"><i class="fa-solid fa-users w-5"></i> Senders</a>
                    <a href="#" onclick="showSection('parcels')" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800 transition-colors"><i class="fa-solid fa-box w-5"></i> Parcels</a>
                    <a href="#" onclick="showSection('payments')" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800 transition-colors"><i class="fa-solid fa-receipt w-5"></i> Payments</a>
                    
                    <div id="admin-menu" class="hidden pt-4 border-t border-slate-800 mt-4">
                        <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Administration</p>
                        <a href="#" onclick="showSection('users')" class="nav-item flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800 transition-colors"><i class="fa-solid fa-user-shield w-5 text-orange-400"></i> Staff Users</a>
                    </div>
                </nav>
            </aside>

            <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
                
                <section id="dashboard-section" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-xl border">
                            <p class="text-gray-500 text-xs font-bold uppercase">Total Today</p>
                            <h3 id="stat-total" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-l-4 border-l-green-500">
                            <p class="text-green-600 text-xs font-bold uppercase">In Transit</p>
                            <h3 id="stat-transit" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-l-4 border-l-blue-500">
                            <p class="text-blue-600 text-xs font-bold uppercase">Pickup Ready</p>
                            <h3 id="stat-pickup" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl border border-l-4 border-l-orange-500">
                            <p class="text-orange-500 text-xs font-bold uppercase">Revenue Today</p>
                            <h3 id="stat-revenue" class="text-2xl font-black mt-1">0</h3>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="showModal('parcelModal')" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition-all">+ New Shipment</button>
                    </div>
                </section>

                <section id="senders-section" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-xl font-bold">Registered Senders</h4>
                        <button onclick="showModal('senderModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm">+ Register Client</button>
                    </div>
                    <div class="bg-white rounded-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-bold">
                                <tr>
                                    <th class="p-4">Full Name</th>
                                    <th class="p-4">Phone</th>
                                    <th class="p-4">ID Number</th>
                                    <th class="p-4">Station</th>
                                    <th class="p-4">Joined</th>
                                </tr>
                            </thead>
                            <tbody id="senderTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

                <section id="parcels-section" class="hidden">
                    <h4 class="text-xl font-bold mb-6">All Shipments</h4>
                    <div class="bg-white rounded-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-bold">
                                <tr>
                                    <th class="p-4">Tracking #</th>
                                    <th class="p-4">Receiver</th>
                                    <th class="p-4">Route</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Date</th>
                                </tr>
                            </thead>
                            <tbody id="parcelTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

                <section id="payments-section" class="hidden">
                    <h4 class="text-xl font-bold mb-6">Transactions</h4>
                    <div class="bg-white rounded-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-bold">
                                <tr>
                                    <th class="p-4">Parcel Ref</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Method</th>
                                    <th class="p-4">Total</th>
                                    <th class="p-4">Paid</th>
                                    <th class="p-4">Balance</th>
                                </tr>
                            </thead>
                            <tbody id="paymentTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

                <section id="users-section" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-xl font-bold">Staff Management</h4>
                        <button onclick="showModal('staffModal')" class="bg-orange-500 text-white px-4 py-2 rounded-lg font-bold text-sm">+ Add Staff</button>
                    </div>
                    <div class="bg-white rounded-xl border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-bold">
                                <tr>
                                    <th class="p-4">Name</th>
                                    <th class="p-4">Role</th>
                                    <th class="p-4">Station</th>
                                    <th class="p-4">Email</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <div id="senderModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center">
        <div class="bg-white rounded-2xl w-full max-w-md p-6">
            <h2 class="text-xl font-black mb-4">New Client</h2>
            <form id="senderForm" class="space-y-4">
                <input type="text" id="clientName" placeholder="Full Name" class="w-full border p-3 rounded-lg" required>
                <input type="text" id="clientPhone" placeholder="Phone Number" class="w-full border p-3 rounded-lg" required>
                <input type="text" id="clientIdNum" placeholder="ID Number (Optional)" class="w-full border p-3 rounded-lg">
                <select id="clientStation" class="w-full border p-3 rounded-lg">
                    <option value="Mbale">Mbale</option>
                    <option value="Kampala">Kampala</option>
                </select>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">Save Client</button>
                <button type="button" onclick="hideModal('senderModal')" class="w-full text-gray-400 text-sm mt-2">Cancel</button>
            </form>
        </div>
    </div>

    <div id="parcelModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl overflow-hidden">
            <div class="bg-blue-600 p-4 text-white flex justify-between">
                <h2 class="font-bold">New Shipment Booking</h2>
                <button onclick="hideModal('parcelModal')">&times;</button>
            </div>
            <form id="createParcelForm" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <p class="text-xs font-bold text-blue-600 uppercase">Sender & Destination</p>
                        <select id="parcelClientId" class="w-full border p-3 rounded-lg" required>
                            <option value="">Select Registered Sender</option>
                        </select>
                        <div class="grid grid-cols-2 gap-2">
                            <select id="origin" class="border p-3 rounded-lg"><option value="Mbale">Mbale</option><option value="Kampala">Kampala</option></select>
                            <select id="destination" class="border p-3 rounded-lg"><option value="Kampala">Kampala</option><option value="Mbale">Mbale</option></select>
                        </div>
                        <input type="text" id="receiverName" placeholder="Receiver Name" class="w-full border p-3 rounded-lg" required>
                    </div>
                    <div class="space-y-4">
                        <p class="text-xs font-bold text-blue-600 uppercase">Parcel Metrics</p>
                        <div class="grid grid-cols-3 gap-2">
                            <input type="number" id="qty" placeholder="Qty" class="border p-3 rounded-lg" value="1" oninput="calcPrice()">
                            <input type="number" id="weight" placeholder="Kg" class="border p-3 rounded-lg" value="1" oninput="calcPrice()">
                            <input type="number" id="volume" placeholder="Vol" class="border p-3 rounded-lg" value="1" oninput="calcPrice()">
                        </div>
                        <textarea id="description" placeholder="Item description..." class="w-full border p-3 rounded-lg h-20"></textarea>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-gray-50 rounded-xl border-2 border-dashed">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div><label class="text-[10px] font-bold">TOTAL (UGX)</label><input type="number" id="totalAmount" class="w-full font-bold text-blue-600 bg-transparent outline-none" readonly></div>
                        <div><label class="text-[10px] font-bold">PAID</label><input type="number" id="amountPaid" class="w-full border-b border-blue-600 bg-transparent outline-none" value="0" oninput="calcPrice()"></div>
                        <div><label class="text-[10px] font-bold">BALANCE</label><input type="number" id="balance" class="w-full text-red-500 bg-transparent outline-none" readonly></div>
                        <select id="payType" class="border p-2 rounded-lg text-sm bg-white"><option value="Cash">Cash</option><option value="Mobile Money">MM</option><option value="Bank">Bank</option></select>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-10 py-3 rounded-lg font-bold shadow-lg">Confirm & Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="staffModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center">
        <div class="bg-white rounded-2xl w-full max-w-md p-6">
            <h2 class="text-xl font-black mb-4">Register Staff</h2>
            <form id="staffForm" class="space-y-4">
                <input type="text" id="staffName" placeholder="Full Name" class="w-full border p-3 rounded-lg" required>
                <input type="email" id="staffEmail" placeholder="Email Address" class="w-full border p-3 rounded-lg" required>
                <input type="password" id="staffPass" placeholder="Password" class="w-full border p-3 rounded-lg" required>
                <div class="grid grid-cols-2 gap-4">
                    <select id="staffRole" class="border p-3 rounded-lg">
                        <option value="clerk">Clerk</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="admin">Admin</option>
                    </select>
                    <select id="staffStation" class="border p-3 rounded-lg">
                        <option value="Kampala">Kampala</option>
                        <option value="Mbale">Mbale</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-lg font-bold">Create Account</button>
                <button type="button" onclick="hideModal('staffModal')" class="w-full text-gray-400 text-sm mt-2">Close</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000"; // Update with your actual backend URL
        const RATE = 2000; // Example Rate

        // UI HELPERS
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        function showSection(sectionId) {
            ['dashboard', 'senders', 'parcels', 'payments', 'users'].forEach(s => {
                const el = document.getElementById(`${s}-section`);
                if(el) el.classList.add('hidden');
            });
            document.getElementById(`${sectionId}-section`).classList.remove('hidden');
            
            // Logic to load data based on section
            if(sectionId === 'senders') loadSenders();
            if(sectionId === 'parcels') loadParcels();
            if(sectionId === 'payments') loadPayments();
            if(sectionId === 'users') loadUsers();
        }

        function calcPrice() {
            const q = parseFloat(document.getElementById('qty').value) || 0;
            const w = parseFloat(document.getElementById('weight').value) || 0;
            const v = parseFloat(document.getElementById('volume').value) || 0;
            const paid = parseFloat(document.getElementById('amountPaid').value) || 0;

            const total = q * w * v * RATE;
            const bal = total - paid;

            document.getElementById('totalAmount').value = total;
            document.getElementById('balance').value = bal;
        }

        // AUTH LOGIC
        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            // Simplify login for demo:
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('staff-name').innerText = "System Admin";
            document.getElementById('staff-station-display').innerText = "Main Office";
            // Check if admin to show menu
            document.getElementById('admin-menu').classList.remove('hidden');
        };

        function handleLogout() {
            location.reload();
        }

        // DATA LOADING (Placeholders - Connect to your backend routes)
        async function loadSenders() { /* fetch and populate senderTableBody */ }
        async function loadParcels() { /* fetch and populate parcelTableBody */ }
        async function loadPayments() { /* fetch and populate paymentTableBody */ }
        async function loadUsers() { /* fetch and populate userTableBody */ }

    </script>

    <script>
        const API_URL = "https://patrinahhotelmgtsys.onrender.com";
        
        let state = {
            currentUser: null,
            parcels: [
                { tracking: "C-99102", sender: "John Doe", receiver: "Mary Joe", destination: "Kampala", status: "In Transit", amount: 50000, balance: 0, pStatus: "Paid" },
                { tracking: "C-99105", sender: "Alex Kato", receiver: "Sarah Nam", destination: "Mbale", status: "Ready for Pickup", amount: 30000, balance: 10000, pStatus: "Partial" }
            ]
        };

        // --- AUTH LOGIC ---
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (res.ok) {
                    const userData = await res.json();
                    localStorage.setItem('courier_user', JSON.stringify(userData));
                    showDashboard(userData);
                } else {
                    errorDiv.classList.remove('hidden');
                }
            } catch (err) {
                console.error("Connection failed", err);
                alert("Server connection failed. Check your internet.");
            }
        });

        function showDashboard(user) {
            state.currentUser = user;
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            
            document.getElementById('staff-name').innerText = user.full_name;
            document.getElementById('staff-station').innerText = `Station: ${user.station}`;
            
            if(user.role === 'admin') {
                document.getElementById('admin-menu').classList.remove('hidden');
            }
            
            updateDateTime();
            renderParcels();
            calculateFinancials();
            if(user.role === 'admin') loadUsers();
        }

        // --- NAVIGATION ---
        function showSection(sectionId) {
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('users-section').classList.add('hidden');
            document.getElementById(`${sectionId}-section`).classList.remove('hidden');
        }

        // --- STAFF MANAGEMENT ---
        async function loadUsers() {
            try {
                const res = await fetch(`${API_URL}/users`);
                const users = await res.json();
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = users.map(u => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 font-bold text-slate-700">${u.full_name}</td>
                        <td class="p-4"><span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-[10px] font-bold uppercase">${u.role}</span></td>
                        <td class="p-4 text-sm">${u.station}</td>
                        <td class="p-4 text-sm text-gray-500">${u.email}</td>
                        <td class="p-4 text-right">
                            <button onclick="deleteUser('${u._id}')" class="text-red-400 hover:text-red-600"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) { console.error(err); }
        }

        document.getElementById('staffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                full_name: document.getElementById('staffName').value,
                email: document.getElementById('staffEmail').value,
                password: document.getElementById('staffPass').value,
                role: document.getElementById('staffRole').value,
                station: document.getElementById('staffStation').value
            };

            try {
                const res = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if(res.ok) {
                    alert("Staff Registered!");
                    hideModal('staffModal');
                    loadUsers();
                    e.target.reset();
                }
            } catch (err) { alert("Error saving staff"); }
        });

        async function deleteUser(id) {
            if(!confirm("Delete this staff member?")) return;
            await fetch(`${API_URL}/users/${id}`, { method: 'DELETE' });
            loadUsers();
        }

        // --- PARCEL LOGIC ---
        function renderParcels() {
            const tbody = document.getElementById('parcelTableBody');
            tbody.innerHTML = state.parcels.map(p => `
                <tr class="hover:bg-blue-50/30">
                    <td class="px-6 py-4 font-mono font-bold text-blue-600">${p.tracking}</td>
                    <td class="px-6 py-4">
                        <div class="font-bold">${p.sender}</div>
                        <div class="text-[10px] text-gray-400">To: ${p.receiver}</div>
                    </td>
                    <td class="px-6 py-4 text-xs font-medium">${p.destination}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${getStatusStyle(p.status)}">${p.status}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-xs font-bold text-slate-400 hover:text-blue-600 uppercase">Manage</button>
                    </td>
                </tr>
            `).join('');
        }

        function calculateFinancials() {
            const rev = state.parcels.reduce((sum, p) => sum + (p.amount - p.balance), 0);
            const bal = state.parcels.reduce((sum, p) => sum + p.balance, 0);
            document.getElementById('rev-today').innerText = `UGX ${rev.toLocaleString()}`;
            document.getElementById('bal-total').innerText = `UGX ${bal.toLocaleString()}`;
            
            // Counters
            document.getElementById('stat-total').innerText = state.parcels.length;
            document.getElementById('stat-transit').innerText = state.parcels.filter(p => p.status === 'In Transit').length;
            document.getElementById('stat-pickup').innerText = state.parcels.filter(p => p.status === 'Ready for Pickup').length;
            document.getElementById('stat-delivered').innerText = state.parcels.filter(p => p.status === 'Delivered').length;
        }

        function getStatusStyle(status) {
            if(status === 'In Transit') return 'bg-green-100 text-green-700';
            if(status === 'Ready for Pickup') return 'bg-blue-100 text-blue-700';
            return 'bg-gray-100 text-gray-600';
        }

        // --- UTILS ---
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('en-GB', { dateStyle: 'long' });
            document.getElementById('current-time').innerText = now.toLocaleTimeString();
        }

        function handleLogout() {
            localStorage.removeItem('courier_user');
            location.reload();
        }

        window.onload = () => {
            const saved = localStorage.getItem('courier_user');
            if(saved) showDashboard(JSON.parse(saved));
            setInterval(updateDateTime, 1000);
        };

        const RATE = 1500; // Base rate per unit

    function calcPrice() {
        const q = parseFloat(document.getElementById('qty').value) || 0;
        const w = parseFloat(document.getElementById('weight').value) || 0;
        const v = parseFloat(document.getElementById('volume').value) || 0;
        const paid = parseFloat(document.getElementById('amountPaid').value) || 0;

        const total = q * w * v * RATE;
        const bal = total - paid;

        document.getElementById('totalAmount').value = total;
        document.getElementById('balance').value = bal;
    }

    // --- NAVIGATION CONTROLLER ---
    function showSection(id) {
        // Hide all sections
        const sections = ['dashboard', 'senders', 'parcels', 'payments', 'users'];
        sections.forEach(s => {
            const el = document.getElementById(`${s}-section`);
            if(el) el.classList.add('hidden');
        });
        // Show target
        document.getElementById(`${id}-section`).classList.remove('hidden');
        
        // Refresh data based on section
        if(id === 'senders') loadSenders();
        if(id === 'payments') loadPayments();
    }

    // --- API CALLS FOR NEW SECTIONS ---
    async function loadSenders() {
        const res = await fetch(`${API_URL}/clients`);
        const clients = await res.json();
        document.getElementById('senderTableBody').innerHTML = clients.map(c => `
            <tr>
                <td class="p-4 font-bold">${c.full_name}</td>
                <td class="p-4">${c.phone}</td>
                <td class="p-4">${c.id_number || 'N/A'}</td>
                <td class="p-4">${c.station}</td>
                <td class="p-4 text-gray-400 text-xs">${new Date(c.created_at).toLocaleDateString()}</td>
            </tr>
        `).join('');
        
        // Populate Parcel Dropdown
        document.getElementById('parcelClientId').innerHTML = '<option value="">Select Sender</option>' + 
            clients.map(c => `<option value="${c._id}">${c.full_name} (${c.phone})</option>`).join('');
    }
    </script>
</body>
</html>
