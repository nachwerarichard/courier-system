<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courier System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        #login-overlay { transition: opacity 0.3s ease-in-out; }
        .active-link { @apply bg-blue-600 text-white shadow-lg; }
        /* Custom scrollbar for better UI */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div id="login-overlay" class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex w-16 h-16 bg-blue-600 rounded-xl items-center justify-center text-white text-3xl font-bold mb-4">C</div>
                <h2 class="text-2xl font-black text-slate-800">COURIER<span class="text-blue-600">SYS</span></h2>
                <p class="text-slate-500 text-sm">Please enter your credentials to continue</p>
            </div>
            
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Staff ID / Email</label>
                    <input type="text" id="username" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="admin@courier.com">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Password</label>
                    <input type="password" id="password" required class="w-full border p-3 rounded-lg outline-blue-500 bg-gray-50" placeholder="••••••••">
                </div>
                <div id="login-error" class="hidden text-red-500 text-xs font-bold bg-red-50 p-3 rounded-lg">
                    <i class="fa-solid fa-circle-exclamation mr-1"></i> Invalid credentials.
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all transform active:scale-95">
                    Sign In to Dashboard
                </button>
            </form>
            <div class="mt-6 text-center text-xs text-slate-400">
                Authorized Personnel Only • 2026 CourierSys v2.0
            </div>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <header class="bg-white border-b px-6 py-3 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded flex items-center justify-center text-white font-bold">C</div>
                <h1 class="font-bold text-xl tracking-tight text-slate-800">COURIER<span class="text-blue-600">SYS</span></h1>
            </div>
            <div class="flex items-center gap-6">
                <div class="text-right border-r pr-4">
                    <p id="staff-name" class="font-semibold text-sm">--</p>
                    <p id="staff-station" class="text-xs text-blue-600 font-medium italic"></p>
                </div>
                <div class="text-right hidden md:block">
                    <p id="current-date" class="text-xs text-gray-500"></p>
                    <p id="current-time" class="text-xs font-mono"></p>
                </div>
                <button onclick="handleLogout()" class="bg-gray-100 hover:bg-red-50 text-red-600 p-2 rounded-full transition-colors">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </button>
            </div>
        </header>

        <div class="flex h-screen overflow-hidden">
            <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col">
                <nav class="flex-1 p-4 space-y-1">
                    <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Main Menu</p>
<a href="#" onclick="showSection('dashboard-section', this)"
   class="nav-item flex items-center gap-3 p-3 bg-blue-600 text-white rounded-lg section">
   <i class="fa-solid fa-chart-line w-5"></i> Dashboard
</a>

<a href="#" onclick="showSection('parcels-section', this)"
   class="nav-item flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg section">
   <i class="fa-solid fa-box w-5"></i> Parcels
</a>
                    <a href="#" onclick="showSection('senders-section', this)"
   class="nav-item flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg section">
   <i class="fa-solid fa-users w-5"></i> Senders
</a>

<a href="#" onclick="showSection('payment-section', this)"
   class="nav-item flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg section">
   <i class="fa-solid fa-receipt w-5"></i> Payments
</a>

                    
                    <div id="admin-menu" class="hidden pt-4 border-t border-slate-800 mt-4">
                        <p class="text-[10px] uppercase font-bold text-slate-500 mb-2 px-3">Administration</p>
                        <a href="#" onclick="showSection('users-section')" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg">
                            <i class="fa-solid fa-user-shield w-5 text-orange-400"></i> Users
                        </a>
                        <a href="#" class="flex items-center gap-3 p-3 hover:bg-slate-800 rounded-lg"><i class="fa-solid fa-gears w-5"></i> System Settings</a>
                    </div>
                </nav>
            </aside>

            <main class="flex-1 overflow-y-auto p-6 pb-24">
                
                <section id="dashboard-section">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Total Today</p>
                            <h3 id="stat-total" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 border-l-4 border-l-green-500">
                            <p class="text-green-600 text-xs font-bold uppercase tracking-wider">In Transit</p>
                            <h3 id="stat-transit" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 border-l-4 border-l-blue-500">
                            <p class="text-blue-600 text-xs font-bold uppercase tracking-wider">Pickup Ready</p>
                            <h3 id="stat-pickup" class="text-2xl font-black mt-1">0</h3>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 border-l-4 border-l-orange-500">
                            <p class="text-orange-500 text-xs font-bold uppercase tracking-wider">Delivered</p>
                            <h3 id="stat-delivered" class="text-2xl font-black mt-1">0</h3>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-6">
                            <h4 class="font-bold text-gray-700 mb-4">Financial Overview</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                        <p class="text-xs font-bold text-green-700 uppercase">Revenue Collected</p>
                                        <p id="rev-today" class="text-2xl font-black text-green-800">UGX 0</p>
                                    </div>
                                    <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                                        <p class="text-xs font-bold text-red-700 uppercase">Outstanding</p>
                                        <p id="bal-total" class="text-2xl font-black text-red-800">UGX 0</p>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-xs font-bold text-gray-500 uppercase mb-3">Payment Stats</p>
                                    <div class="space-y-4" id="payment-bars">
                                        </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border p-6">
                            <h4 class="font-bold text-gray-700 mb-4">Quick Actions</h4>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="showModal('parcel-modal')" class="flex items-center gap-3 w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold shadow-md transition-all">
                                    <i class="fa-solid fa-plus-circle"></i> Create New Parcel
                                </button>
                                <button class="flex items-center gap-3 w-full bg-white hover:bg-gray-50 border p-3 rounded-lg font-medium text-gray-700">
                                    <i class="fa-solid fa-magnifying-glass text-slate-400"></i> Track Waybill
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <div class="p-4 border-b bg-gray-50 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h4 class="font-bold text-gray-700">Recent Shipments</h4>
                            <div class="flex gap-2">
                                <input type="text" id="tableSearch" placeholder="Search Tracking..." class="border rounded-lg px-3 py-1.5 text-sm">
                                <select id="statusFilter" class="border rounded-lg px-3 py-1.5 text-sm">
                                    <option value="All">All</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Delivered">Delivered</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-white border-b text-[10px] uppercase font-black text-gray-400">
                                    <tr>
                                        <th class="px-6 py-4">Tracking #</th>
                                        <th class="px-6 py-4">Sender/Receiver</th>
                                        <th class="px-6 py-4">Route</th>
                                        <th class="px-6 py-4 text-center">Status</th>
                                        <th class="px-6 py-4 text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="parcelTableBody" class="divide-y divide-gray-100 text-sm"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
                <!-- Payments Section -->
<section id="payments-section" class="hidden p-6">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-2xl font-bold text-slate-800">Payments</h2>
            <p class="text-slate-500 text-sm">View and manage all payment transactions.</p>
        </div>
    </div>

    <!-- Payments Table -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
        <table class="w-full text-left">
            <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Payment ID</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Parcel ID</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Payment Status</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Payment Type</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Total Amount</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Amount Paid</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Balance</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Received By</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Payment Date</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500 text-right">Actions</th>
                </tr>
            </thead>
            <tbody id="payments-table-body" class="divide-y divide-slate-100">
                <!-- Payment rows will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

</section>

                <!-- Senders Section -->
<section id="senders-section" class="hidden p-6">

    <!-- Header + Add Sender Button -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-2xl font-bold text-slate-800">Senders / Clients</h2>
            <p class="text-slate-500 text-sm">Manage all sender information.</p>
        </div>
        <button onclick="showModal('sender-modal')"
                class="bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex items-center gap-2">
            <i class="fa-solid fa-plus"></i> Add Sender
        </button>
    </div>

    <!-- Senders Table -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <table class="w-full text-left">
            <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Full Name</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Phone</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">ID Number</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Station</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Created At</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500 text-right">Actions</th>
                </tr>
            </thead>
            <tbody id="senders-table-body" class="divide-y divide-slate-100">
                <!-- Sender rows will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

</section>
<!-- Sender Modal -->
<div id="sender-modal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl">
        <div class="p-6 border-b flex justify-between items-center">
            <h2 class="text-xl font-black">Add New Sender</h2>
            <button onclick="hideModal('sender-modal')" class="text-gray-400 text-2xl">&times;</button>
        </div>
        <form id="createSenderForm" class="p-6 grid grid-cols-1 gap-4">
            
            <input type="text" id="fullName" placeholder="Full Name" class="w-full border p-3 rounded-lg" required>
            <input type="text" id="phone" placeholder="Phone" class="w-full border p-3 rounded-lg" required>
            <input type="text" id="idNumber" placeholder="ID Number (Optional)" class="w-full border p-3 rounded-lg">
            
            <select id="station" class="w-full border p-3 rounded-lg" required>
                <option value="">Select Station</option>
                <option value="Kampala">Kampala</option>
                <option value="Mbale">Mbale</option>
            </select>
            
            <div class="flex justify-end gap-3 mt-4">
                <button type="submit" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg">
                    Add Sender
                </button>
            </div>
        </form>
    </div>
</div>


                <section id="users-section" class="hidden">
                    <div class="bg-white rounded-xl shadow-sm border p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h4 class="font-bold text-xl text-gray-800">System Staff</h4>
                                <p class="text-sm text-gray-500">Manage access for clerks and supervisors</p>
                            </div>
                            <button onclick="showModal('staffModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm">
                                <i class="fa-solid fa-user-plus mr-2"></i>Register Staff
                            </button>
                        </div>
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400">
                                <tr>
                                    <th class="p-4">Name</th>
                                    <th class="p-4">Role</th>
                                    <th class="p-4">Station</th>
                                    <th class="p-4">Email</th>
                                    <th class="p-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                    </div>
                </section>
                <section id="parcels-section" class="hidden p-6">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-2xl font-bold text-slate-800">Parcel Registry</h2>
            <p class="text-slate-500 text-sm">Manage and track all incoming and outgoing shipments.</p>
        </div>
        <button onclick="openParcelModal()" class="bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex items-center gap-2">
            <i class="fa-solid fa-plus"></i> Register New Parcel
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-white p-4 rounded-xl border border-slate-200">
            <p class="text-slate-500 text-xs uppercase font-bold">Total Parcels</p>
            <h3 id="stat-total" class="text-2xl font-bold text-slate-800">0</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <table class="w-full text-left">
            <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Tracking Info</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Client / Receiver</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Route</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Pricing</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500">Status</th>
                    <th class="p-4 text-xs uppercase font-bold text-slate-500 text-right">Actions</th>
                </tr>
            </thead>
            <tbody id="parcel-table-body" class="divide-y divide-slate-100">
                </tbody>
        </table>
    </div>
</section>
 <div id="parcel-modal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-xl font-black">New Shipment</h2>
<button onclick="hideModal('parcel-modal')"
        class="text-gray-400 text-2xl">&times;</button>
            </div>
            <form id="createParcelForm" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">

    <!-- Sender -->
    <div class="space-y-4">
        <p class="text-xs font-bold text-blue-600 uppercase">Sender Details</p>

        <input type="hidden" id="client_id">

        <input type="text" id="senderName"
               placeholder="Sender Name"
               class="w-full border p-3 rounded-lg" required>

        <input type="text" id="senderPhone"
               placeholder="Sender Phone"
               class="w-full border p-3 rounded-lg" required>

        <select id="origin" class="w-full border p-3 rounded-lg" required>
            <option value="">Origin</option>
            <option value="Kampala">Kampala</option>
            <option value="Mbale">Mbale</option>
        </select>
    </div>

    <!-- Receiver -->
    <div class="space-y-4">
        <p class="text-xs font-bold text-blue-600 uppercase">Receiver Details</p>

        <input type="text" id="receiverName"
               placeholder="Receiver Name"
               class="w-full border p-3 rounded-lg" required>

        <select id="destination" class="w-full border p-3 rounded-lg" required>
            <option value="">Destination</option>
            <option value="Kampala">Kampala</option>
            <option value="Mbale">Mbale</option>
        </select>
    </div>

    <!-- Parcel Info -->
    <div class="md:col-span-2 space-y-4">
        <p class="text-xs font-bold text-blue-600 uppercase">Parcel Details</p>

        <textarea id="description"
                  placeholder="Description of items"
                  class="w-full border p-3 rounded-lg h-20"></textarea>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <input type="number" id="quantity" placeholder="Qty"
                   class="border p-3 rounded-lg" required>

            <input type="number" step="0.01" id="weight"
                   placeholder="Weight (kg)"
                   class="border p-3 rounded-lg">

            <input type="number" step="0.01" id="volume"
                   placeholder="Volume (m³)"
                   class="border p-3 rounded-lg">

            <input type="number" id="rate"
                   placeholder="Rate"
                   class="border p-3 rounded-lg" required>
        </div>
    </div>

    <!-- Status -->
    <div class="md:col-span-2">
        <select id="status" class="w-full border p-3 rounded-lg">
            <option value="At Dispatch">At Dispatch</option>
            <option value="In Transit">In Transit</option>
            <option value="Ready for Pickup">Ready for Pickup</option>
            <option value="Delivered">Delivered</option>
        </select>
    </div>

    <!-- Submit -->
    <div class="md:col-span-2 flex justify-end mt-4">
        <button type="submit"
                class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg">
            Register & Print Waybill
        </button>
    </div>

</form>

        </div>
    </div>
<div id="parcel-modals" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-200">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
            <h3 class="text-xl font-bold text-slate-800" id="modal-title">Register New Parcel</h3>
            <button onclick="closeParcelModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <form id="parcel-form" class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Client ID</label>
                    <input type="number" id="client_id" required class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Receiver Name</label>
                    <input type="text" id="receiver_name" required class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Origin</label>
                    <select id="origin" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg outline-none">
                        <option value="Mbale">Mbale</option>
                        <option value="Kampala">Kampala</option>
                    </select>
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Destination</label>
                    <select id="destination" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg outline-none">
                        <option value="Kampala">Kampala</option>
                        <option value="Mbale">Mbale</option>
                    </select>
                </div>

                <div class="grid grid-cols-3 col-span-2 gap-4 bg-blue-50/50 p-4 rounded-xl border border-blue-100">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-blue-600 uppercase">Qty</label>
                        <input type="number" id="quantity" value="1" oninput="calculateParcelPrice()" class="w-full p-2 border border-blue-200 rounded">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-blue-600 uppercase">Weight (kg)</label>
                        <input type="number" step="0.1" id="weight" value="1" oninput="calculateParcelPrice()" class="w-full p-2 border border-blue-200 rounded">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-blue-600 uppercase">Volume</label>
                        <input type="number" step="0.1" id="volume" value="1" oninput="calculateParcelPrice()" class="w-full p-2 border border-blue-200 rounded">
                    </div>
                </div>

                <div class="col-span-2 space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Calculated Price (UGX)</label>
                    <input type="number" id="price" readonly class="w-full p-3 bg-slate-800 text-white font-mono text-xl rounded-lg">
                </div>
                <div class="col-span-2 space-y-1">
                    <label class="text-xs font-bold text-slate-600 uppercase">Description / Details</label>
                    <textarea id="description" rows="2" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg outline-none"></textarea>
                </div>
            </div>

            <div class="mt-6 flex gap-3">
                <button type="button" onclick="closeParcelModal()" class="flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-lg transition-colors">Discard</button>
                <button type="submit" class="flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all">Confirm Shipment</button>
            </div>
        </form>
    </div>
</div>

            </main>
        </div>
    </div>

    <div id="staffModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl">
            <h2 class="text-xl font-black mb-4">Register New Staff</h2>
            <form id="staffForm" class="space-y-4">
                <input type="text" id="staffName" placeholder="Full Name" class="w-full border p-3 rounded-lg" required>
                <input type="email" id="staffEmail" placeholder="Email Address" class="w-full border p-3 rounded-lg" required>
                <input type="password" id="staffPass" placeholder="Password" class="w-full border p-3 rounded-lg" required>
                <div class="grid grid-cols-2 gap-4">
                    <select id="staffRole" class="border p-3 rounded-lg">
                        <option value="clerk">Clerk</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="admin">Admin</option>
                    </select>
                    <select id="staffStation" class="border p-3 rounded-lg">
                        <option value="Kampala">Kampala</option>
                        <option value="Mbale">Mbale</option>
                        <option value="Gulu">Gulu</option>
                        <option value="Mbarara">Mbarara</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold shadow-lg">Save Staff Member</button>
                <button type="button" onclick="hideModal('staffModal')" class="w-full text-gray-400 text-sm mt-2">Close</button>
            </form>
        </div>
    </div>

    <div id="parcelModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-xl font-black">New Shipment</h2>
                <button onclick="hideModal('parcelModal')" class="text-gray-400 text-2xl">&times;</button>
            </div>
            <form id="createParcelForm" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-4">
                    <p class="text-xs font-bold text-blue-600 uppercase">Sender Details</p>
                    <input type="text" id="senderName" placeholder="Sender Name" class="w-full border p-3 rounded-lg" required>
                    <input type="text" id="senderPhone" placeholder="Sender Phone" class="w-full border p-3 rounded-lg" required>
                </div>
                <div class="space-y-4">
                    <p class="text-xs font-bold text-blue-600 uppercase">Receiver Details</p>
                    <input type="text" id="receiverName" placeholder="Receiver Name" class="w-full border p-3 rounded-lg" required>
                    <select id="destination" class="w-full border p-3 rounded-lg" required>
                        <option value="Kampala">Kampala</option>
                        <option value="Mbale">Mbale</option>
                    </select>
                </div>
                <div class="md:col-span-2 space-y-4">
                    <p class="text-xs font-bold text-blue-600 uppercase">Payment & Description</p>
                    <textarea id="description" placeholder="Description of items" class="w-full border p-3 rounded-lg h-20"></textarea>
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="totalAmount" placeholder="Total UGX" class="border p-3 rounded-lg">
                        <input type="number" id="amountPaid" placeholder="Paid UGX" class="border p-3 rounded-lg">
                        <select id="paymentStatus" class="border p-3 rounded-lg">
                            <option value="Paid">Fully Paid</option>
                            <option value="Partial">Partial</option>
                            <option value="Unpaid">Unpaid</option>
                        </select>
                    </div>
                </div>
                <div class="md:col-span-2 flex justify-end gap-3 mt-4">
                    <button type="submit" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg">Register & Print Waybill</button>
                </div>
            </form>
        </div>
    </div>

    <script>
// Reuse modal functions
function showModal(modalId) {
    document.getElementById(modalId)?.classList.remove('hidden');
}

function hideModal(modalId) {
    document.getElementById(modalId)?.classList.add('hidden');
}

// Handle sender form submission
document.getElementById('createSenderForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const fullName = document.getElementById('fullName').value;
    const phone = document.getElementById('phone').value;
    const idNumber = document.getElementById('idNumber').value || '-';
    const station = document.getElementById('station').value;
    const createdAt = new Date().toLocaleString();

    // Insert row in table (frontend only)
    const tbody = document.getElementById('senders-table-body');
    const row = document.createElement('tr');
    row.innerHTML = `
        <td class="p-4">${fullName}</td>
        <td class="p-4">${phone}</td>
        <td class="p-4">${idNumber}</td>
        <td class="p-4">${station}</td>
        <td class="p-4">${createdAt}</td>
        <td class="p-4 text-right">
            <button class="text-red-500 hover:underline" onclick="this.closest('tr').remove()">Delete</button>
        </td>
    `;
    tbody.appendChild(row);

    // Reset form & close modal
    this.reset();
    hideModal('sender-modal');
});
</script>


    <script>
function hideModal(modalId) {
    const modal = document.getElementById(modalId);

    if (!modal) {
        console.error('Modal not found:', modalId);
        return;
    }

    modal.classList.add('hidden');
}
</script>

<script>
function showSection(sectionId, clickedLink) {

    // Hide all sections
    document.querySelectorAll('section').forEach(section => {
        section.classList.add('hidden');
    });

    // Find the requested section
    const targetSection = document.getElementById(sectionId);

    if (!targetSection) {
        console.error('Section not found:', sectionId);
        return;
    }

    targetSection.classList.remove('hidden');

    // Reset nav styles
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('bg-blue-600', 'text-white');
        item.classList.add('hover:bg-slate-800');
    });

    // Activate clicked nav item
    clickedLink.classList.add('bg-blue-600', 'text-white');
    clickedLink.classList.remove('hover:bg-slate-800');
}
</script>


    <script>
        const API_URL = "https://patrinahhotelmgtsys.onrender.com";
        
        let state = {
            currentUser: null,
            parcels: [
                { tracking: "C-99102", sender: "John Doe", receiver: "Mary Joe", destination: "Kampala", status: "In Transit", amount: 50000, balance: 0, pStatus: "Paid" },
                { tracking: "C-99105", sender: "Alex Kato", receiver: "Sarah Nam", destination: "Mbale", status: "Ready for Pickup", amount: 30000, balance: 10000, pStatus: "Partial" }
            ]
        };

        // --- AUTH LOGIC ---
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (res.ok) {
                    const userData = await res.json();
                    localStorage.setItem('courier_user', JSON.stringify(userData));
                    showDashboard(userData);
                } else {
                    errorDiv.classList.remove('hidden');
                }
            } catch (err) {
                console.error("Connection failed", err);
                alert("Server connection failed. Check your internet.");
            }
        });

        function showDashboard(user) {
            state.currentUser = user;
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            
            document.getElementById('staff-name').innerText = user.full_name;
            document.getElementById('staff-station').innerText = `Station: ${user.station}`;
            
            if(user.role === 'admin') {
                document.getElementById('admin-menu').classList.remove('hidden');
            }
            
            updateDateTime();
            renderParcels();
            calculateFinancials();
            if(user.role === 'admin') loadUsers();
        }

        // --- NAVIGATION ---



        // --- STAFF MANAGEMENT ---
        async function loadUsers() {
            try {
                const res = await fetch(`${API_URL}/users`);
                const users = await res.json();
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = users.map(u => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 font-bold text-slate-700">${u.full_name}</td>
                        <td class="p-4"><span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-[10px] font-bold uppercase">${u.role}</span></td>
                        <td class="p-4 text-sm">${u.station}</td>
                        <td class="p-4 text-sm text-gray-500">${u.email}</td>
                        <td class="p-4 text-right">
                            <button onclick="deleteUser('${u._id}')" class="text-red-400 hover:text-red-600"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) { console.error(err); }
        }

        document.getElementById('staffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                full_name: document.getElementById('staffName').value,
                email: document.getElementById('staffEmail').value,
                password: document.getElementById('staffPass').value,
                role: document.getElementById('staffRole').value,
                station: document.getElementById('staffStation').value
            };

            try {
                const res = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if(res.ok) {
                    alert("Staff Registered!");
                    hideModal('staffModal');
                    loadUsers();
                    e.target.reset();
                }
            } catch (err) { alert("Error saving staff"); }
        });

        async function deleteUser(id) {
            if(!confirm("Delete this staff member?")) return;
            await fetch(`${API_URL}/users/${id}`, { method: 'DELETE' });
            loadUsers();
        }

        // --- PARCEL LOGIC ---
        function renderParcels() {
            const tbody = document.getElementById('parcelTableBody');
            tbody.innerHTML = state.parcels.map(p => `
                <tr class="hover:bg-blue-50/30">
                    <td class="px-6 py-4 font-mono font-bold text-blue-600">${p.tracking}</td>
                    <td class="px-6 py-4">
                        <div class="font-bold">${p.sender}</div>
                        <div class="text-[10px] text-gray-400">To: ${p.receiver}</div>
                    </td>
                    <td class="px-6 py-4 text-xs font-medium">${p.destination}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${getStatusStyle(p.status)}">${p.status}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-xs font-bold text-slate-400 hover:text-blue-600 uppercase">Manage</button>
                    </td>
                </tr>
            `).join('');
        }

        function calculateFinancials() {
            const rev = state.parcels.reduce((sum, p) => sum + (p.amount - p.balance), 0);
            const bal = state.parcels.reduce((sum, p) => sum + p.balance, 0);
            document.getElementById('rev-today').innerText = `UGX ${rev.toLocaleString()}`;
            document.getElementById('bal-total').innerText = `UGX ${bal.toLocaleString()}`;
            
            // Counters
            document.getElementById('stat-total').innerText = state.parcels.length;
            document.getElementById('stat-transit').innerText = state.parcels.filter(p => p.status === 'In Transit').length;
            document.getElementById('stat-pickup').innerText = state.parcels.filter(p => p.status === 'Ready for Pickup').length;
            document.getElementById('stat-delivered').innerText = state.parcels.filter(p => p.status === 'Delivered').length;
        }

        function getStatusStyle(status) {
            if(status === 'In Transit') return 'bg-green-100 text-green-700';
            if(status === 'Ready for Pickup') return 'bg-blue-100 text-blue-700';
            return 'bg-gray-100 text-gray-600';
        }

        // --- UTILS ---
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('en-GB', { dateStyle: 'long' });
            document.getElementById('current-time').innerText = now.toLocaleTimeString();
        }

        function handleLogout() {
            localStorage.removeItem('courier_user');
            location.reload();
        }

        window.onload = () => {
            const saved = localStorage.getItem('courier_user');
            if(saved) showDashboard(JSON.parse(saved));
            setInterval(updateDateTime, 1000);
        };
    </script>
    <script>
const SHIPPING_RATE = 2000; // Example rate per unit

/**
 * READ: Fetch and Display Parcels
 */
async function fetchParcels() {
    try {
        const response = await fetch(API_BASE);
        const parcels = await response.json();
        const tbody = document.getElementById('parcel-table-body');
        
        document.getElementById('stat-total').innerText = parcels.length;
        
        tbody.innerHTML = parcels.map(p => `
            <tr class="hover:bg-slate-50 transition-colors group">
                <td class="p-4">
                    <div class="font-mono text-blue-600 font-bold">${p.tracking_number}</div>
                    <div class="text-[10px] text-slate-400">${new Date(p.created_at).toLocaleDateString()}</div>
                </td>
                <td class="p-4">
                    <div class="text-sm font-semibold text-slate-700">${p.receiver_name}</div>
                    <div class="text-xs text-slate-400 font-mono italic">CID: ${p.client_id}</div>
                </td>
                <td class="p-4">
                    <div class="flex items-center gap-2 text-xs font-medium text-slate-600">
                        <span class="px-2 py-0.5 bg-slate-100 rounded">${p.origin}</span>
                        <i class="fa-solid fa-arrow-right text-[10px] text-slate-300"></i>
                        <span class="px-2 py-0.5 bg-slate-100 rounded">${p.destination}</span>
                    </div>
                </td>
                <td class="p-4 font-bold text-slate-800">
                    UGX ${p.price.toLocaleString()}
                </td>
                <td class="p-4">
                    <span class="text-[10px] font-bold uppercase px-2.5 py-1 rounded-full ${getStatusStyle(p.status)}">
                        ${p.status}
                    </span>
                </td>
                <td class="p-4 text-right">
                    <button onclick="deleteParcel('${p._id}')" class="text-slate-300 hover:text-red-500 transition-colors">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    } catch (err) {
        console.error("Failed to load parcels:", err);
    }
}

/**
 * CREATE: Submit Form to Backend
 */
document.getElementById('parcel-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const parcelData = {
        client_id: document.getElementById('client_id').value,
        receiver_name: document.getElementById('receiver_name').value,
        origin: document.getElementById('origin').value,
        destination: document.getElementById('destination').value,
        quantity: document.getElementById('quantity').value,
        weight: document.getElementById('weight').value,
        volume: document.getElementById('volume').value,
        price: document.getElementById('price').value,
        description: document.getElementById('description').value
    };

    try {
        const response = await fetch(API_BASE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(parcelData)
        });

        if (response.ok) {
            closeParcelModal();
            fetchParcels(); // Refresh table
        }
    } catch (err) {
        alert("Error saving parcel");
    }
});

/**
 * DELETE: Remove Parcel
 */
async function deleteParcel(id) {
    if (confirm('Are you sure you want to delete this parcel record?')) {
        await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
        fetchParcels();
    }
}

/**
 * UI & Calculation Helpers
 */
function calculateParcelPrice() {
    const q = document.getElementById('quantity').value || 1;
    const w = document.getElementById('weight').value || 1;
    const v = document.getElementById('volume').value || 1;
    // Calculation: Qty * Weight * Volume * Rate
    const total = q * w * v * SHIPPING_RATE;
    document.getElementById('price').value = Math.round(total);
}

function openParcelModal() {
    document.getElementById('parcel-form').reset();
    calculateParcelPrice();
    document.getElementById('parcel-modal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('parcel-modal').classList.add('hidden');
}

function getStatusStyle(status) {
    switch(status) {
        case 'Delivered': return 'bg-green-100 text-green-700';
        case 'In Transit': return 'bg-blue-100 text-blue-700';
        case 'Ready for Pickup': return 'bg-purple-100 text-purple-700';
        default: return 'bg-amber-100 text-amber-700';
    }
}

window.showSection = showSection;

        <script>
// Example function to add a payment row (frontend only)
function addPaymentRow(payment) {
    const tbody = document.getElementById('payments-table-body');
    const row = document.createElement('tr');

    // Destructure payment object
    const {
        payment_id,
        parcel_id,
        payment_status,
        payment_type,
        total_amount,
        amount_paid,
        balance,
        received_by,
        payment_date
    } = payment;

    row.innerHTML = `
        <td class="p-4">${payment_id}</td>
        <td class="p-4">${parcel_id}</td>
        <td class="p-4">${payment_status}</td>
        <td class="p-4">${payment_type || '-'}</td>
        <td class="p-4">${total_amount.toFixed(2)}</td>
        <td class="p-4">${amount_paid.toFixed(2)}</td>
        <td class="p-4">${balance.toFixed(2)}</td>
        <td class="p-4">${received_by}</td>
        <td class="p-4">${payment_date}</td>
        <td class="p-4 text-right">
            <button class="text-red-500 hover:underline" onclick="this.closest('tr').remove()">Delete</button>
        </td>
    `;
    tbody.appendChild(row);
}

// Example usage
addPaymentRow({
    payment_id: 1,
    parcel_id: 101,
    payment_status: 'Paid',
    payment_type: 'Cash',
    total_amount: 50000,
    amount_paid: 50000,
    balance: 0,
    received_by: 'Staff A',
    payment_date: new Date().toLocaleString()
});
</script>


    </script>
</body>
</html>
