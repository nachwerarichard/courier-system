<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CourierSys | Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        #login-overlay { transition: opacity 0.3s ease-in-out; }
        .nav-item-active { @apply bg-blue-600 text-white shadow-lg; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div id="login-overlay" class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-flex w-16 h-16 bg-blue-600 rounded-xl items-center justify-center text-white text-3xl font-bold mb-4">C</div>
                <h2 class="text-2xl font-black text-slate-800">COURIER<span class="text-blue-600">SYS</span></h2>
            </div>
            <form id="loginForm" class="space-y-5">
                <input type="text" id="loginUsername" required class="w-full border p-3 rounded-lg outline-blue-500" placeholder="Staff Email">
                <input type="password" id="loginPassword" required class="w-full border p-3 rounded-lg outline-blue-500" placeholder="Password">
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg">Sign In</button>
            </form>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <header class="bg-white border-b px-6 py-3 flex justify-between items-center sticky top-0 z-50">
            <h1 class="font-bold text-xl tracking-tight text-slate-800">COURIER<span class="text-blue-600">SYS</span></h1>
            <div class="flex items-center gap-6">
                <div class="text-right border-r pr-4">
                    <p id="staff-name-display" class="font-semibold text-sm">--</p>
                    <p id="staff-station-display" class="text-xs text-blue-600 italic"></p>
                </div>
                <button onclick="handleLogout()" class="text-red-600"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </header>

        <div class="flex h-screen overflow-hidden">
            <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col">
                <nav class="flex-1 p-4 space-y-1">
                    <a href="#" onclick="showSection('dashboard')" class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
                    <a href="#" onclick="showSection('senders')" class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800"><i class="fa-solid fa-user-plus"></i> Senders</a>
                    <a href="#" onclick="showSection('receivers')" class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800"><i class="fa-solid fa-truck-ramp-box"></i> Receivers/Parcels</a>
                    <a href="#" onclick="showSection('payments')" class="nav-link flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800"><i class="fa-solid fa-receipt"></i> Payments</a>
                </nav>
            </aside>

            <main class="flex-1 overflow-y-auto p-6 pb-24">
                
                <section id="dashboard-section">
                    <h2 class="text-2xl font-bold mb-4">Operations Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border">
                            <p class="text-gray-500 text-xs font-bold uppercase">Total Senders</p>
                            <h3 id="count-senders" class="text-3xl font-black">0</h3>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border">
                            <p class="text-gray-500 text-xs font-bold uppercase">Revenue Today</p>
                            <h3 id="rev-display" class="text-3xl font-black text-green-600">0</h3>
                        </div>
                    </div>
                </section>

                <section id="senders-section" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Registered Senders</h2>
                        <button onclick="showModal('senderModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold"><i class="fa-solid fa-plus mr-2"></i>New Sender</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-500">
                                <tr>
                                    <th class="p-4">Name</th>
                                    <th class="p-4">Phone</th>
                                    <th class="p-4">ID Number</th>
                                    <th class="p-4">Origin</th>
                                    <th class="p-4">Date</th>
                                </tr>
                            </thead>
                            <tbody id="senderTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

                <section id="receivers-section" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">Receiver & Parcel Details</h2>
                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-500">
                                <tr>
                                    <th class="p-4">Tracking #</th>
                                    <th class="p-4">Receiver</th>
                                    <th class="p-4">Destination</th>
                                    <th class="p-4">Status</th>
                                </tr>
                            </thead>
                            <tbody id="receiverTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

                <section id="payments-section" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">Financial Records</h2>
                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-500">
                                <tr>
                                    <th class="p-4">Tracking #</th>
                                    <th class="p-4">Total Amt</th>
                                    <th class="p-4">Paid</th>
                                    <th class="p-4">Balance</th>
                                    <th class="p-4">Status</th>
                                </tr>
                            </thead>
                            <tbody id="paymentTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <div id="senderModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center">
        <div class="bg-white rounded-2xl w-full max-w-md p-6">
            <h2 class="text-xl font-black mb-4">Register Sender</h2>
            <form id="senderForm" class="space-y-4">
                <input type="text" id="regFullName" placeholder="Full Name" class="w-full border p-3 rounded-lg" required>
                <input type="text" id="regPhone" placeholder="Phone Number" class="w-full border p-3 rounded-lg" required>
                <input type="text" id="regIdNum" placeholder="ID Number (Optional)" class="w-full border p-3 rounded-lg">
                <select id="regStation" class="w-full border p-3 rounded-lg">
                    <option value="Kampala">Kampala</option>
                    <option value="Mbale">Mbale</option>
                </select>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">Save Sender</button>
                <button type="button" onclick="hideModal('senderModal')" class="w-full text-gray-400 mt-2">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = "http://localhost:5000/api";

        // Navigation Logic
        function showSection(sectionId) {
            const sections = ['dashboard', 'senders', 'receivers', 'payments'];
            sections.forEach(s => document.getElementById(`${s}-section`).classList.add('hidden'));
            document.getElementById(`${sectionId}-section`).classList.remove('hidden');
            
            if(sectionId === 'senders') fetchSenders();
            if(sectionId === 'receivers') fetchParcels();
            if(sectionId === 'payments') fetchPayments();
        }

        // Modal Logic
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        // Data Fetching: Senders
        async function fetchSenders() {
            const res = await fetch(`${API_BASE}/senders`);
            const data = await res.json();
            const tbody = document.getElementById('senderTableBody');
            tbody.innerHTML = data.map(s => `
                <tr>
                    <td class="p-4 font-bold">${s.full_name}</td>
                    <td class="p-4">${s.phone}</td>
                    <td class="p-4">${s.id_number || 'N/A'}</td>
                    <td class="p-4">${s.station}</td>
                    <td class="p-4 text-xs text-gray-400">${new Date(s.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        // Form Submission: Senders
        document.getElementById('senderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const senderData = {
                full_name: document.getElementById('regFullName').value,
                phone: document.getElementById('regPhone').value,
                id_number: document.getElementById('regIdNum').value,
                station: document.getElementById('regStation').value
            };

            const res = await fetch(`${API_BASE}/senders`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(senderData)
            });

            if(res.ok) {
                alert("Sender Registered");
                hideModal('senderModal');
                fetchSenders();
                e.target.reset();
            }
        });

        // Initialize
        window.onload = () => {
            // Check auth here as per previous code...
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        };
    </script>
</body>
</html>
