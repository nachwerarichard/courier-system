<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Parcel - Courier System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-100 p-2 md:p-8">
    <div id="update-container" class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl">
        <div class="p-6 border-b bg-blue-600 text-white rounded-t-2xl">
             <h3 class="text-xl font-bold uppercase">Parcel Management</h3>
             <p id="tracking-display" class="text-sm opacity-80">Loading tracking info...</p>
        </div>

        <form id="updateParcelForm" class="p-6">
            <div class="flex flex-col md:flex-row justify-end gap-4 mt-8 pt-6 border-t">
                 <select id="status" class="px-4 py-3 border-2 border-blue-500 rounded-xl font-bold text-blue-600 outline-none">
                    <option value="At Dispatch">At Dispatch</option>
                    <option value="In Transit">In Transit</option>
                    <option value="Ready for Pickup">Ready for Pickup</option>
                    <option value="Delivered">Delivered</option>
                    <option value="Partially received">Partially Received</option>
                 </select>
                 
                 <button type="submit" class="bg-green-600 text-white px-10 py-3 rounded-xl font-bold shadow-lg">
                    Save Updates
                 </button>
            </div>
        </form>
    </div>

    <script>
        const API_URL = "https://patrinahhotelmgtsys.onrender.com";
        const urlParams = new URLSearchParams(window.location.search);
        const parcelId = urlParams.get('id');

        // 1. Fetch Data on Load
        async function loadParcelData() {
            if (!parcelId) return alert("No Parcel ID provided");

            try {
                const response = await fetch(`${API_URL}/api/parcels/${parcelId}`);
                const parcel = await response.json();

                if (response.ok) {
                    fillForm(parcel);
                } else {
                    alert("Parcel not found");
                }
            } catch (err) {
                console.error("Error:", err);
            }
        }

        // 2. Fill every field from your Schema
        function fillForm(parcel) {
            document.getElementById('tracking-display').innerText = "Waybill: " + parcel.tracking_number;
            
            // Basic Details
            document.getElementById('senderName').value = parcel.sender_name || '';
            document.getElementById('senderPhone').value = parcel.sender_phone || '';
            document.getElementById('origin').value = parcel.origin || '';
            
            document.getElementById('receiverName').value = parcel.receiver_name || '';
            document.getElementById('receiverPhone').value = parcel.receiver_phone || '';
            document.getElementById('destination').value = parcel.destination || '';

            // Financials
            document.getElementById('totalAmount').value = parcel.total_amount || 0;
            document.getElementById('amountPaid').value = parcel.amount_paid || 0;
            document.getElementById('balance').value = parcel.balance || 0;
            document.getElementById('paymentStatus').value = parcel.payment_status || 'Unpaid';
            document.getElementById('paymentType').value = parcel.payment_method || 'Cash';
            document.getElementById('status').value = parcel.status || 'At Dispatch';

            // Items (If you have a global array for the list)
            currentConsignment = parcel.items || [];
            renderParcelList(); // Re-use your existing rendering function
        }

        window.onload = loadParcelData;
    </script>
</body>
</html>
